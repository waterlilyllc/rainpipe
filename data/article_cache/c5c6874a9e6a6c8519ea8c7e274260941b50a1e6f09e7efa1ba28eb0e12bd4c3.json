{
  "url": "https://zenn.dev/pnd/articles/claude-code-statusline",
  "content": {
    "text": "Claude Code ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ®‹é‡ã‚’å¸¸ã«è¡¨ç¤ºã™ã‚‹ Zenn ogino ğŸ‘ï¸ Claude Code ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ®‹é‡ã‚’å¸¸ã«è¡¨ç¤ºã™ã‚‹ 2025/08/09 ã«å…¬é–‹ 3 ä»¶ AI Claude Code tech Claude Code ã® v1.0.71 ã§ã€TUI ã®æœ€ä¸‹éƒ¨ã«è¡¨ç¤ºã™ã‚‹ status line ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚µã‚¤ã‚ºã‚„ auto-compact ã¾ã§ã®æ®‹é‡ã‚’å¸¸ã«å¯è¦–åŒ–ã—ã¦ãŠããŸã‚ã«ä¾¿åˆ©ã§ã™ã€‚ ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ Claude ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå¹… (ãƒ¢ãƒ‡ãƒ«ã«ä¸€åº¦ã«å…¥åŠ›ã§ãã‚‹ä¸Šé™ãƒˆãƒ¼ã‚¯ãƒ³æ•°) ã¯ 200K ãƒˆãƒ¼ã‚¯ãƒ³ã§ã™ã€‚ Claude Code ã¯ã“ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå¹…ã«åˆ°é”ã™ã‚‹å‰ã«ã€å¤§ä½“ 80% ãã‚‰ã„ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§è‡ªå‹•çš„ã« /compact ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ /compact ã¯ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’åœ§ç¸®ã™ã‚‹ãŸã‚ã«ã€éå»ã®ä¼šè©±å±¥æ­´ã®æƒ…å ±ã‚’å¤§å¹…ã«è½ã¨ã—ãŸè¦ç´„ã‚’ä½œã‚Šã¾ã™ã€‚ ãã®çµæœã€å¿…è¦ãªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒè¶³ã‚Šãšã« Claude Code ãŒè¿·èµ°ã™ã‚‹ã“ã¨ãŒéå¸¸ã«ã‚ˆãã‚ã‚Šã¾ã™ã€‚ ãã®ãŸã‚ã€auto-compact ã¾ã§å¾Œã©ã‚Œãã‚‰ã„ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ãˆã‚‹ã‹ã‚’å¸¸ã«æŠŠæ¡ã—ã¦ãŠããŸã„ã‚ã‘ã§ã™ãŒã€ Claude Code ã¯ auto-compact ã®ç›´å‰ã¾ã§æƒ…å ±ã‚’è¡¨ç¤ºã—ã¾ã›ã‚“ã€‚ ã“ã®ä¸ä¾¿ã•ã‚’è§£æ¶ˆã™ã‚‹ãŸã‚ã«ã¡ã‚‡ã†ã©è‰¯ã„æ©Ÿèƒ½ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚ŒãŸã®ã§ã€æ—©é€Ÿåˆ©ç”¨ã—ã¾ã—ã‚‡ã†ã€‚ è¨­å®šæ–¹æ³• ã¾ãšã€ä¸‹è¨˜ã®è¨­å®šã‚’ .claude/settings.json ã«è¿½åŠ ã—ã¾ã™ã€‚ { \"statusLine\" : { \"type\" : \"command\" , \"command\" : \"~/.claude/statusline.js\" } } statusline.js ã®ä¸­èº«ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚ #!/usr/bin/env node const fs = require ( 'fs' ) ; const path = require ( 'path' ) ; const readline = require ( 'readline' ) ; // Constants const COMPACTION_THRESHOLD = 200000 * 0.8 // Read JSON from stdin let input = '' ; process . stdin . on ( 'data' , chunk =&gt; input += chunk ) ; process . stdin . on ( 'end' , async ( ) =&gt; { try { const data = JSON . parse ( input ) ; // Extract values const model = data . model ?. display_name || 'Unknown' ; const currentDir = path . basename ( data . workspace ?. current_dir || data . cwd || '.' ) ; const sessionId = data . session_id ; // Calculate token usage for current session let totalTokens = 0 ; if ( sessionId ) { // Find all transcript files const projectsDir = path . join ( process . env . HOME , '.claude' , 'projects' ) ; if ( fs . existsSync ( projectsDir ) ) { // Get all project directories const projectDirs = fs . readdirSync ( projectsDir ) . map ( dir =&gt; path . join ( projectsDir , dir ) ) . filter ( dir =&gt; fs . statSync ( dir ) . isDirectory ( ) ) ; // Search for the current session's transcript file for ( const projectDir of projectDirs ) { const transcriptFile = path . join ( projectDir , ` ${ sessionId } .jsonl ` ) ; if ( fs . existsSync ( transcriptFile ) ) { totalTokens = await calculateTokensFromTranscript ( transcriptFile ) ; break ; } } } } // Calculate percentage const percentage = Math . min ( 100 , Math . round ( ( totalTokens / COMPACTION_THRESHOLD ) * 100 ) ) ; // Format token display const tokenDisplay = formatTokenCount ( totalTokens ) ; // Color coding for percentage let percentageColor = '\\x1b[32m' ; // Green if ( percentage &gt;= 70 ) percentageColor = '\\x1b[33m' ; // Yellow if ( percentage &gt;= 90 ) percentageColor = '\\x1b[31m' ; // Red // Build status line const statusLine = ` [ ${ model } ] ğŸ“ ${ currentDir } | ğŸª™ ${ tokenDisplay } | ${ percentageColor } ${ percentage } %\\x1b[0m ` ; console . log ( statusLine ) ; } catch ( error ) { // Fallback status line on error console . log ( '[Error] ğŸ“ . | ğŸª™ 0 | 0%' ) ; } } ) ; async function calculateTokensFromTranscript ( filePath ) { return new Promise ( ( resolve , reject ) =&gt; { let lastUsage = null ; const fileStream = fs . createReadStream ( filePath ) ; const rl = readline .",
    "extracted_at": "2025-08-13T13:19:53+09:00"
  },
  "cached_at": "2025-08-13T13:19:53+09:00"
}